import router from "./router";
import store from "./store";
const whiteList = ["/login", "/register"];
router.beforeEach(async(to, from, next) => {
    document.title = to.meta.title + "-Lx";
    let roles = store.state.user.role;
    if (roles)
        if (store.state.permission.routes.length > 0) "/login" === to.path || "/" === to.path ?
            next({ path: store.state.permission.addRoutes[0].path }) : next();
        else {
            const accessRoutes = await store.dispatch("permission/generateRoutes", roles);
            router.addRoutes(accessRoutes), next({...to })
        }
    else -1 !== whiteList.indexOf(to.path) ? next() : next("/login")
});